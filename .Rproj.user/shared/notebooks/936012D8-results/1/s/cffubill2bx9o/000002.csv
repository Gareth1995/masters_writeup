"0",""
"0","# finding yearly change per year for migrant group"
"0","# extract species with certain trait"
"0","migtype_trends <- function(traitsdf, countsdf, mig, title, ylab, xlab, trait){"
"0",""
"0","  # traitsdf <- robertsDB"
"0","  # countsdf <- bp_counts"
"0","  # mig <- ""Aquatic"""
"0","  # title <- """""
"0","  # trait = ""nest"""
"0",""
"0","  if (trait == ""migrant""){"
"0","    Ids <- traitsdf[which(traitsdf$Migrant==mig),]$SppRef"
"0","    t <- countsdf[,Ids]"
"0","  }else if(trait == ""nest""){"
"0","    Ids <- traitsdf[which(traitsdf$`Nest site`==mig),]$SppRef"
"0","    t <- countsdf[,Ids]"
"0","  }else if(trait == ""forage""){"
"0","    Ids <- traitsdf[which(traitsdf$numForage==mig),]$SppRef"
"0","    t <- countsdf[,Ids]"
"0","  }"
"0",""
"0",""
"0","  # run jags on each species in trait group"
"0","  trait_species <- list()"
"0",""
"0","  for (i in 1:length(t)){"
"0","    trait_species[[i]] <- jags_analysis(as.data.frame(cbind(t[,i],"
"0","                                                          'Season' = countsdf$Season,"
"0","                                                          'Year' = countsdf$Year)))"
"0","  }"
"0",""
"0","  # sum together all sim lists"
"0","  migtot <- data.frame(matrix(0, 9000, 26))"
"0","  for(i in 1:length(trait_species)){"
"0",""
"0","    migtot <- migtot + trait_species[[i]]$sims.list$mu_t"
"0",""
"0","  }"
"0",""
"0","  # loop through sims list to find lower median and upper quantile of percentage change"
"0","  perc_change <- data.frame(lower = 0, med = 0, upper = 0)"
"0","  for(x in 2:26){"
"0","    # using median and lower and upper quantile"
"0","    perc_change[x,] = quantile(((migtot[,x] - migtot[,x-1]) / (migtot[,x-1]))*100, c(0.025,0.5,0.975))"
"0","  }"
"0","  perc_change <- cbind(perc_change, ""Year"" = unique(bp_counts$Year))"
"0",""
"0","  # plotting the output"
"0","  yrlychange.plot <- ggplot(perc_change, aes(x = Year)) +"
"0","    geom_ribbon(aes(ymin = lower, ymax = upper), fill = ""gray80"") +"
"0","    geom_line(aes(y = med, color = ""red""), lwd = 1) +"
"0","    geom_hline(yintercept=0, linetype = 'dashed') +"
"0","    scale_x_continuous(breaks = seq(min(perc_change$Year), max(perc_change$Year), by = 1)) +"
"0","    #scale_y_continuous(breaks = round(seq(min(perc_change$lower), max(perc_change$upper), by = 10),0)) +"
"0","    labs(title = title, y = ylab, x = xlab) +"
"0","    theme(axis.text.x = element_text(angle = 90),"
"0","          legend.position = 'none')"
"0",""
"0","  return(list(""jag.mods"" = trait_species,"
"0","              ""peryr.plot"" = yrlychange.plot,"
"0","              ""indices"" = perc_change))"
"0","}"
